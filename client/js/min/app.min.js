$(document).foundation();var socket=io.connect("http://bs1.adventurestory.net:3000");socket.on("connected",function(){console.log("Connected successfully to socket");var e={};e.cmdLog=[],e.cmdLogIndex=-1;var o=new Room(document.location.hash.substr(1));o.id?$("#registerClient").foundation("reveal","open",{closeOnBackgroundClick:!1}):$("#createRoom").foundation("reveal","open",{closeOnBackgroundClick:!1}),$(".createRoom").on("click",function(){socket.emit("createRoom")}),$("form.login input[name=name]").on("keydown",function(){input=$(this),setTimeout(function(){input.val().length>0?input.parent().find("input[type=submit]").removeAttr("disabled"):input.parent().find("input[type=submit]").attr("disabled","disabled")},100)}),$("form.login").submit(function(){return e.name=$(this).find("input[name=name]").val(),socket.emit("registerClient",{name:e.name,roomID:o.id}),$(this).closest("form").foundation("reveal","close"),$("#socket-room-link").val(document.URL+"#"+o.id).on("click",function(){$(this).select()}),$("body").addClass("loggedIn"),!1}),$("form#socket-chatbox").submit(function(){var t=$(this).find("[name=socket-message]").val();return $(this).find("[name=socket-message]").val(""),t&&("/"!=t.charAt(0)&&(t="/say "+t),console.log("Message: ",t),socket.emit("doCmd",{sender:e.id,roomID:o.id,text:t}),e.cmdLogIndex=-1,"/say"!=t.toLowerCase().slice(0,4)&&e.cmdLog.unshift(t)),!1}).on("keyup",function(o){switch(o.keyCode){case 38:e.cmdLogIndex+1<e.cmdLog.length&&$("[name=socket-message]").val(e.cmdLog[++e.cmdLogIndex]);break;case 40:e.cmdLogIndex-1>=0&&$("[name=socket-message]").val(e.cmdLog[--e.cmdLogIndex])}console.log(e.cmdLogIndex,e.cmdLog.length,e.cmdLog)}),$("#dice .dice").on("click",function(){var t=$(this).closest("tr").find("input[type=number]").val(),n=$(this).closest("tr").attr("class"),s="/roll "+t+n;socket.emit("doCmd",{sender:e.id,roomID:o.id,text:s})}),socket.on("roomCreated",function(e){console.log("roomCreated: ",e),o.id=e.roomID}),socket.on("clientRegistered",function(o){console.log("clientRegistered: ",o),e.id=o.userID,e.isAdmin=o.admin}),socket.on("sendClients",function(e){console.log("sendClients: ",e),$("#socket-users").html(""),$.each(e.clients,function(e,t){o.users.push(t),0==e&&o.admins.push(t);var n=0==e?"admin":"user";$("#socket-users").append('<li class="'+n+'" data-tooltip title="Whisper with '+t+'">'+t+" "),$("#socket-users li").on("click",function(){$("[name=socket-message]").val("/whisper "+$(this).text())})}),$("#socket-room").append("<p>You are connected to room "+o.id+"</p>")}),socket.on("updateClients",function(){socket.emit("getClients",{sender:e.ID,roomID:o.id})}),socket.on("say",function(e){var t=$("#socket-room");if(t[0].scrollHeight-t.outerHeight()<t.scrollTop())var n=!0;var s=e.text.split(":",1)[0],i=e.text.substring(s.length+1,e.text.length),c=s==o.admins[0]?"admin":"user";t.append('<p><span class="'+c+'">'+s+':</span> <span class="'+e.type+'">'+i+"</span></p>"),n&&t.scrollTop(t[0].scrollHeight),console.log("Room now: ",o)})});