$(document).foundation();var socket=io.connect("http://bs1.adventurestory.net:3000");socket.on("connected",function(){console.log("Connected successfully to socket");var e={},o=new Room(document.location.hash.substr(1));o.id?$("#registerClient").foundation("reveal","open",{closeOnBackgroundClick:!1}):$("#createRoom").foundation("reveal","open",{closeOnBackgroundClick:!1}),$(".createRoom").on("click",function(){socket.emit("createRoom")}),$("form.login").submit(function(){return e.name=$(this).find("input[name=name]").val(),socket.emit("registerClient",{name:e.name,roomID:o.id}),$(this).closest("form").foundation("reveal","close"),$("body").addClass("loggedIn"),!1}),$("form#socket-chatbox").submit(function(){var n=$(this).find("[name=socket-message]").val();return $(this).find("[name=socket-message]").val(""),n&&("/"!=n.charAt(0)&&(n="/say "+n),console.log("Message: ",n),socket.emit("doCmd",{sender:e.id,roomID:o.id,text:n})),!1}),socket.on("roomCreated",function(e){console.log("roomCreated: ",e),o.id=e.roomID}),socket.on("clientRegistered",function(o){console.log("clientRegistered: ",o),e.id=o.userID,e.isAdmin=o.admin}),socket.on("sendClients",function(e){console.log("sendClients: ",e),$("#socket-users").html(""),$.each(e.clients,function(e,n){o.users.push(n),0==e&&o.admins.push(n);var t=0==e?"admin":"user";$("#socket-users").append('<li class="'+t+'" title="Whisper with '+n+'">'+n),$("#socket-users li").on("click",function(){$("[name=socket-message]").val("/whisper "+$(this).text())})}),$("#socket-room").append("<p>You are connected to room "+o.id+"</p>")}),socket.on("updateClients",function(){socket.emit("getClients",{sender:e.ID,roomID:o.id})}),socket.on("say",function(e){var n=$("#socket-room");if(n[0].scrollHeight-n.outerHeight()<n.scrollTop())var t=!0;var s=e.text.split(":",1)[0],c=e.text.substring(s.length+1,e.text.length),i=s==o.admins[0]?"admin":"user";n.append('<p><span class="'+i+'">'+s+':</span> <span class="'+e.type+'">'+c+"</span></p>"),t&&n.scrollTop(n[0].scrollHeight),console.log("Room now: ",o)})});