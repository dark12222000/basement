$(document).foundation();var user={},socket=io.connect("http://bs1.adventurestory.net:3000");socket.on("connected",function(){console.log("Connected successfully to socket");var e={id:document.location.hash.substr(1)};e.id?$("#registerClient").foundation("reveal","open",{closeOnBackgroundClick:!1}):$("#createRoom").foundation("reveal","open",{closeOnBackgroundClick:!1}),$(".createRoom").on("click",function(){socket.emit("createRoom")}),$("form.login").submit(function(){return socket.emit("registerClient",{name:$(this).find("input[name=name]").val(),roomID:e.id}),$(this).closest("form").foundation("reveal","close"),!1}),$("form#socket-chatbox").submit(function(){var o=$(this).find("[name=socket-message]").val();return $(this).find("[name=socket-message]").val(""),o&&("/"!=o.charAt(0)&&(o="/say "+o),console.log("Message: ",o),socket.emit("doCmd",{sender:user.id,roomID:e.id,text:o})),!1}),socket.on("roomCreated",function(o){console.log("roomCreated: ",o),e.id=o.roomID}),socket.on("clientRegistered",function(o){console.log("clientRegistered: ",o),user.id=o.userID,user.isAdmin=o.admin,$("#socket-connected").fadeIn().find("#socket-url").val(document.location.pathname+"#"+e.id).on("click",function(){this.select()})}),socket.on("sendClients",function(o){console.log("sendClients: ",o),$("#socket-users").html(""),$.each(o.clients,function(e,o){var t=0==e?"admin":"user";$("#socket-users").append('<li class="'+t+'">'+o)}),$("#socket-room").append("<p>You are connected to room "+e.id+"</p>")}),socket.on("updateClients",function(){socket.emit("getClients",{sender:user.ID,roomID:e.id})}),socket.on("say",function(e){var o=$("#socket-room");if(o[0].scrollHeight-o.outerHeight()<o.scrollTop())var t=!0;var s=e.text.split(":",1)[0],n=e.text.substring(s.length+1,e.text.length),c=s==$("#socket-users li:first").text()?"admin":"user";o.append('<p><span class="'+c+'">'+s+':</span> <span class="'+e.type+'">'+n+"</span></p>"),t&&o.scrollTop(o[0].scrollHeight)})});