$(document).foundation();var socket=io.connect("http://bs1.adventurestory.net:3000");socket.on("connected",function(){console.log("Connected successfully to socket");var e={},o=new Room(document.location.hash.substr(1));o.id?$("#registerClient").foundation("reveal","open",{closeOnBackgroundClick:!1}):$("#createRoom").foundation("reveal","open",{closeOnBackgroundClick:!1}),$(".createRoom").on("click",function(){socket.emit("createRoom")}),$("form.login").submit(function(){return e.name=$(this).find("input[name=name]").val(),socket.emit("registerClient",{name:e.name,roomID:o.id}),$(this).closest("form").foundation("reveal","close"),!1}),$("form#socket-chatbox").submit(function(){var t=$(this).find("[name=socket-message]").val();return $(this).find("[name=socket-message]").val(""),t&&("/"!=t.charAt(0)&&(t="/say "+t),console.log("Message: ",t),socket.emit("doCmd",{sender:e.id,roomID:o.id,text:t})),!1}),socket.on("roomCreated",function(e){console.log("roomCreated: ",e),o.id=e.roomID}),socket.on("clientRegistered",function(o){console.log("clientRegistered: ",o),e.id=o.userID,e.isAdmin=o.admin}),socket.on("sendClients",function(e){console.log("sendClients: ",e),$("#socket-users").html(""),$.each(e.clients,function(e,t){o.users.push(t),0==e&&o.admins.push(t);var n=0==e?"admin":"user";$("#socket-users").append('<li class="'+n+'">'+t)}),$("#socket-room").append("<p>You are connected to room "+o.id+"</p>")}),socket.on("updateClients",function(){socket.emit("getClients",{sender:e.ID,roomID:o.id})}),socket.on("say",function(e){var t=$("#socket-room");if(t[0].scrollHeight-t.outerHeight()<t.scrollTop())var n=!0;var s=e.text.split(":",1)[0],c=e.text.substring(s.length+1,e.text.length),i=s==o.admins[0]?"admin":"user";t.append('<p><span class="'+i+'">'+s+':</span> <span class="'+e.type+'">'+c+"</span></p>"),n&&t.scrollTop(t[0].scrollHeight),console.log("Room now: ",o)})});