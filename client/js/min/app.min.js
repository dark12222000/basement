$(document).foundation();var socket=io.connect("http://bs1.adventurestory.net:3000");socket.on("connected",function(){console.log("Connected successfully to socket");var e={},o={id:document.location.hash.substr(1)};o.id?$("#registerClient").foundation("reveal","open",{closeOnBackgroundClick:!1}):$("#createRoom").foundation("reveal","open",{closeOnBackgroundClick:!1}),$(".createRoom").on("click",function(){socket.emit("createRoom")}),$("form.login").submit(function(){return socket.emit("registerClient",{name:$(this).find("input[name=name]").val(),roomID:o.id}),$(this).closest("form").foundation("reveal","close"),!1}),$("form#socket-chatbox").submit(function(){var t=$(this).find("[name=socket-message]").val();return $(this).find("[name=socket-message]").val(""),t&&("/"!=t.charAt(0)&&(t="/say "+t),console.log("Message: ",t),socket.emit("doCmd",{sender:e.id,roomID:o.id,text:t})),!1}),socket.on("roomCreated",function(e){console.log("roomCreated: ",e),o.id=e.roomID}),socket.on("clientRegistered",function(t){console.log("clientRegistered: ",t),e.id=t.userID,e.isAdmin=t.admin,$("#socket-connected").fadeIn().find("#socket-url").val(document.location.pathname+"#"+o.id).on("click",function(){this.select()}),socket.emit("getClients",{sender:e.ID,roomID:o.id})}),socket.on("sendClients",function(e){console.log("sendClients: ",e),console.log("Connected Clients are: ",e.clients),$("#socket-users").html(""),$.each(e.clients,function(e,o){$("#socket-users").append("<li>"+o)}),$("#socket-room").text("You are connected to room "+o.id)}),socket.on("updateClients",function(){socket.emit("getClients",{sender:e.ID,roomID:o.id})}),socket.on("say",function(e){console.log("Server said: ",e);var o=$("#socket-room");if(o[0].scrollHeight-o.outerHeight()<o.scrollTop())var t=!0;var n=e.text.split(":",1)[0],s=e.text.substring(n.length+1,e.text.length);o.append('<p><span class="username">'+n+':</span> <span class="'+e.type+'">'+s+"</span></p>"),t&&o.scrollTop(o[0].scrollHeight)})});